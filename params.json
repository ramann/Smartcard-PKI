{
  "name": "Smartcard PKI",
  "tagline": "",
  "body": "# Smartcard PKI\r\n## Instructions to use two smartcards to create a CA and client cert. As the private keys are stored on the cards, you don't have to be (as) paranoid about their security. \r\n\r\n### Source: http://pki-tutorial.readthedocs.org/en/latest/simple/ for a very basic PKI\r\n\r\n### The details:\r\n1. On the Client card and the Signing CA card\r\n\r\n  ```pkcs15-init -E```\r\n  \r\n  ```pkcs15-init --create-pkcs15 -p pkcs15+onepin --pin 1234 --puk 4321```\r\n\r\n  ```pkcs15-init -G rsa/2048 -i 01 -a 01 -u sign --pin 1234```\r\n\r\n2. create dirs and db\r\n\r\n  ```mkdir -p ca/signing-ca/db crl certs```\r\n  \r\n  ```chmod 700 ca/signing-ca/private```\r\n  \r\n  ```cp /dev/null ca/signing-ca/db/signing-ca.db```\r\n  \r\n  ```cp /dev/null ca/signing-ca/db/signing-ca.db.attr```\r\n  \r\n  ```echo 01 > ca/signing-ca/db/signing-ca.crt.srl```\r\n  \r\n  ```echo 01 > ca/signing-ca/db/signing-ca.crl.srl```\r\n\r\n3. with the Signing CA card in the computer...\r\n\r\n  ```openssl req -new -config etc/signing-ca.conf -out ca/signing-ca.csr -key slot_1-id_01 -keyform engine -engine pkcs11```\r\n\r\n  ```openssl ca -selfsign -config etc/signing-ca.conf -in ca/signing-ca.csr -out ca/signing-ca.crt -keyform engine -engine pkcs11 -keyfile slot_1-id_01 -extensions signing_ca_ext```\r\n\r\n4. with the Client card in the computer\r\n\r\n  ```openssl req -new -config etc/email.conf -out certs/me.csr -key slot_1-id_01 -keyform engine -engine pkcs11```\r\n\r\n5. with the Signing CA card back in the computer, issue the client cert\r\n\r\n  ```openssl ca -config etc/signing-ca.conf -in certs/me.csr -out certs/me.crt -keyfile slot_1-id_01 -keyform engine -engine pkcs11```\r\n\r\n6. also, why not store the CA cert on the CA card\r\n\r\n  ```pkcs15-init -X ca/signing-ca.crt -i 01 -a 01 ```\r\n\r\n7. with the Client card in the reader, store the cert on the card\r\n\r\n  ```pkcs15-init -X certs/me.crt -i 01 -a 01```\r\n\r\n8. Take a look at the pam_pkcs11 setup instructions and use this instead of a self-signed cert\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}